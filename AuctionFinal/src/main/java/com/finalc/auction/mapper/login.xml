<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<!-- ==== 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체내에서 유일해야 한다.) ==== -->
<mapper namespace="login">
	<select id="getLoginMember" parameterType="HashMap" resultType="com.finalc.auction.model.MemberVO">
		select userid, passwd, email, username, email, usernum, hp1
		     , hp2, hp3, addr1, addr2, user_status, gender, birth, grade
		from
		(
		select *
		from tbl_member A join TBL_MEMBER_DETAIL B
		on A.userid = B.fk_userid
		)V
		where user_status = 1 and
		userid = #{userid} and
		passwd = #{passwd}
	</select>
	
	<select id="idCheck" parameterType="String" resultType="Integer">
		select count(*)
		from tbl_member
		where userid = #{userid}
	</select>
	
	<insert id="memberRegist" parameterType="HashMap">
		insert into tbl_member(userid, passwd, user_status)
		values(#{userid}, #{pwd}, default)
	</insert>
	
	<insert id="memberRegistDetail" parameterType="HashMap">
		insert into tbl_member_detail(usernum, fk_userid, username, birth, gender, email, zipcode, addr1, addr2, hp1, hp2, hp3)
		values(seq_member_detail.nextval, (select userid from tbl_member where userid = #{userid}), #{name}, #{birth}, #{gender}, #{email1} || '@' || #{email2}, to_number(#{zipcode}), #{addr1}, #{addr2}, #{hp1},  #{hp2},  #{hp3})
	</insert>
	 
	<select id="serchZipcode" parameterType="com.finalc.auction.model.ZipcodeVO">
		select zipcode, sido||' '||sigungu||' '||eupmyun||' '||doro||' '||building||' '||buildname||' '||dongname||' '||riname||' '||dong2name AS address
		from tbl_zipcode
		where sido like '%' || #{sido} || '%'
	</select>
	
	<update id="updatePwdUser" parameterType="String">
		update tbl_member set passwd = #{pwd}
		where userid = #{userid}
	</update>
	
	<select id="isUserExists" parameterType="String" resultType="Integer">
		select count(*)
		from tbl_member A join tbl_member_detail B
		on A.userid = B.fk_userid
		where userid = #{userid}
	</select>
	 
</mapper>